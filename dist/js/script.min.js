(()=>{"use strict";const e=document.querySelector(".board-message"),t=document.querySelector(".data-enter"),a=document.querySelector(".login-btn"),n=document.querySelector(".password-form"),s=n.querySelectorAll("input"),c=document.querySelector(".submit-btn");c.disabled=!0;const o=document.querySelector(".error"),r=document.querySelector(".create-visit-btn"),i=document.querySelector(".visit-form"),d=document.querySelector(".doctor"),l=document.querySelector(".visit-form-info"),u=l.querySelectorAll("input"),m=document.querySelector(".urgency-select"),p={},f=document.querySelector(".create-button"),h=document.querySelector(".close"),v=document.querySelector(".cards"),y=document.querySelector(".filters"),L=document.querySelector(".filter-button"),g=y.querySelectorAll("input"),E=y.querySelector(".urgency-filter"),b=y.querySelector(".doctor-filter");function w(e){const t=document.createElement("div");v.append(t),t.classList.add("card"),t.dataset.id=e.id;const a=document.createElement("div");t.append(a),a.classList.add("card-info");const n=document.createElement("div");a.append(n),n.classList.add("change-info");const s=document.createElement("h2");a.append(s),s.innerText=e.name;const c=document.createElement("div");a.append(c),c.classList.add("doctor-name"),c.innerText=e.doctor;const o=document.createElement("div");a.append(o);const r=document.createElement("button");o.append(r),r.classList.add("show-more-btn");const i=document.createElement("button");o.append(i),i.classList.add("edit-btn");const d=document.createElement("div");a.append(d),d.classList.add("icon");const l=document.createElement("span");d.append(l),l.classList.add("delete-icon");const u=document.createElement("div");c.after(u),u.classList.add("extra-info");for(const t in e)if("id"!==t&&"doctor"!==t&&"name"!==t){const a=document.createElement("p");u.append(a),a.classList.add("extra-property"),a.style.display="flex";const n=document.createElement("span");a.append(n),n.classList.add("propName"),n.innerText=`${t}`;const s=document.createElement("span");a.append(s),s.classList.add("propValue"),s.innerText=`:   ${e[t]}`}}function T(e,t){const a=document.createElement("p");e.append(a),a.innerText=`${t}`,a.classList.add("loading"),setTimeout(A,2e3,a)}function A(e){e.remove()}let S,x,q,k,C;a.addEventListener("click",(e=>{n.classList.add("visible"),a.classList.add("deactive")})),s.forEach((e=>{e.addEventListener("input",(t=>{""!==t.target.value&&(c.disabled=!1),"email"===e.getAttribute("type")?x=t.target.value:q=t.target.value}))})),c.addEventListener("click",(async a=>{a.preventDefault(),globalThis.Token=await async function(e,t){try{return(await fetch("https://ajax.test-danit.com/api/v2/cards/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:`${e}`,password:`${t}`})})).text()}catch(e){console.error("Виникла проблема з Вашим fetch-запросом: "+e)}}(x,q),"Incorrect username or password"!==Token?(n.classList.remove("visible"),r.classList.remove("hidden"),t.classList.add("data-enter-none"),async function(){await T(y,"DOWNLOAD CARDS..."),S=await async function(){try{const e=await fetch("https://ajax.test-danit.com/api/v2/cards",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Token}`}});return await e.json()}catch(e){console.error("Виникла проблема з Вашим fetch-запросом: "+e)}}(),S.length>0&&e.classList.add("board-message-none"),S.forEach((e=>{setTimeout(w,400,e)}))}()):o.innerHTML="Помилка у email<br>або password!"}));class j{constructor(e){const{purpose:t,description:a,urgency:n,name:s}=e;this.purpose=t,this.description=a,this.urgency=n,this.name=s}}class D extends j{constructor(e){super(e);const{data:t,doctor:a}=e;this.data=t,this.doctor=a}}class O extends j{constructor(e){super(e);const{age:t,doctor:a}=e;this.age=t,this.doctor=a}}class R extends j{constructor(e){super(e);const{pressure:t,index:a,disease:n,age:s,doctor:c}=e;this.pressure=t,this.index=a,this.disease=n,this.age=s,this.doctor=c}}async function I(e){try{const t=await fetch("https://ajax.test-danit.com/api/v2/cards",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Token}`},body:JSON.stringify(e)}),a=await t.json();return S.push(a),a.id}catch(e){console.error("Виникла проблема з Вашим fetch-запросом: "+e)}}function N(e){e.remove()}function B(e,t){t.firstChild.remove();const a=document.createElement("div");t.append(a),a.classList.add("card-info");const n=document.createElement("div");a.append(n),n.classList.add("change-info");const s=document.createElement("h2");a.append(s),s.innerText=e.name;const c=document.createElement("div");a.append(c),c.classList.add("doctor-name"),c.innerText=e.doctor;const o=document.createElement("div");a.append(o);const r=document.createElement("button");o.append(r),r.classList.add("show-more-btn");const i=document.createElement("button");o.append(i),i.classList.add("edit-btn");const d=document.createElement("div");a.append(d),d.classList.add("icon");const l=document.createElement("span");d.append(l),l.classList.add("delete-icon");const u=document.createElement("div");c.after(u),u.classList.add("extra-info");for(const t in e)if("id"!==t&&"doctor"!==t&&"name"!==t){const a=document.createElement("p");u.append(a),a.classList.add("extra-property"),a.style.display="flex";const n=document.createElement("span");a.append(n),n.classList.add("propName"),n.innerText=`${t}`;const s=document.createElement("span");a.append(s),s.classList.add("propValue"),s.innerText=`:   ${e[t]}`}}function z(e,t,a,n){const s={},c=document.createElement("div");t.prepend(c),c.classList.add("change-div");for(const t in e)if("id"!==t&&"doctor"!==t){const a=document.createElement("div");c.append(a),a.style.display="flex";const n=document.createElement("p");a.append(n),n.innerText=`${t}: `;const s=document.createElement("input");a.append(s),s.name=t,s.value=e[t]}const o=document.createElement("button");c.append(o),o.classList.add("save-change"),o.innerText="Зберегти";const r=c.querySelectorAll("input");o.addEventListener("click",(t=>{s.id=e.id,s.doctor=e.doctor,r.forEach((e=>{s[`${e.name}`]=e.value})),a.classList.toggle("edit-btn"),a.classList.toggle("edit-close-btn"),c.remove(),async function(e,t){await T(t.querySelector(".doctor-name"),"SAVE INFO...");const a=await async function(e){try{const t=await fetch(`https://ajax.test-danit.com/api/v2/cards/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Token}`},body:JSON.stringify(e)});return await t.json()}catch(e){console.error("Виникла проблема з Вашим fetch-запросом: "+e)}}(e);setTimeout(await B,2e3,a,t),S.forEach(((e,t)=>{e.id===a.id&&S.splice(t,1,a)}))}(s,n)}))}r.addEventListener("click",(e=>{i.classList.add("visible"),r.classList.add("hidden")})),d.addEventListener("click",(e=>{k=e.target.value,k&&(l.classList.add("visible"),u.forEach((e=>{e.style.display="flex",e.dataset.extra&&e.dataset.extra!==k&&(e.style.display="none")})))})),h.addEventListener("click",(e=>{e.preventDefault(),i.classList.remove("visible"),l.classList.remove("visible"),r.classList.remove("hidden"),u.forEach((e=>{e.value=""}))})),m.addEventListener("click",(e=>{p.urgency=e.target.value})),f.addEventListener("click",(t=>{t.preventDefault(),p.doctor=k,u.forEach((e=>{e.value&&(p[`${e.name}`]=e.value)})),"dentist"===k&&async function(e){const t=new D(e);await T(v,"CREATE CARD..."),t.id=await I(t),setTimeout(await w,2e3,t)}(p)||"therapist"===k&&async function(e){const t=new O(e);await T(v,"CREATE CARD..."),t.id=await I(t),setTimeout(await w,2e3,t)}(p)||"cardiologist"===k&&async function(e){const t=new R(e);await T(v,"CREATE CARD..."),t.id=await I(t),setTimeout(await w,2e3,t)}(p),i.classList.remove("visible"),r.classList.remove("hidden"),l.classList.remove("visible"),e.classList.add("board-message-none"),u.forEach((e=>{e.value=""}))})),v.addEventListener("click",(async t=>{if(t.target.parentElement.classList.contains("icon")||t.target.classList.contains("icon")){await T(t.target.closest(".card-info").querySelector(".doctor-name"),"DELETE CARD...");let e=await async function(e){try{return(await fetch(`https://ajax.test-danit.com/api/v2/cards/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${Token}`}})).status}catch(e){console.error("Виникла проблема з Вашим fetch-запросом: "+e)}}(t.target.closest(".card").dataset.id);200===e&&setTimeout(N,2e3,t.target.closest(".card")),S.forEach(((e,a)=>{+t.target.closest(".card").dataset.id===e.id&&S.splice(a,1)}))}!v.querySelector(".card")&&e.classList.remove("board-message-none")})),v.addEventListener("click",(e=>{(e.target.classList.contains("show-more-btn")||e.target.classList.contains("show-less-btn"))&&(e.target.closest(".card-info").querySelector(".extra-info").classList.toggle("visible"),e.target.classList.toggle("show-less-btn"),e.target.classList.toggle("show-more-btn"))})),v.addEventListener("click",(async e=>{if(e.target.classList.contains("edit-btn")||e.target.classList.contains("edit-close-btn"))if(e.target.closest(".card-info").firstChild.firstChild)e.target.classList.toggle("edit-btn"),e.target.classList.toggle("edit-close-btn"),e.target.closest(".card-info").firstChild.firstChild.remove();else{await T(e.target.closest(".card-info").querySelector(".doctor-name"),"LOADING CARD INFO...");const t=await async function(e){try{const t=await fetch(`https://ajax.test-danit.com/api/v2/cards/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Token}`}});return await t.json()}catch(e){console.error("Виникла проблема з Вашим fetch-запросом: "+e)}}(e.target.closest(".card").dataset.id);setTimeout(await z,2e3,t,e.target.closest(".card-info").firstChild,e.target,e.target.closest(".card")),e.target.classList.toggle("edit-btn"),e.target.classList.toggle("edit-close-btn")}}));let P="";b.addEventListener("click",(e=>{C="doctor",P=e.target.value})),E.addEventListener("click",(e=>{C="urgency",P=e.target.value})),L.addEventListener("click",(e=>{e.preventDefault(),L.classList.contains("reset-button")?(v.querySelectorAll(".card").forEach((e=>{e.style.display="block"})),L.classList.remove("reset-button"),L.innerText="Фільтрувати",g.forEach((e=>{e.value=""})),C="",P="",b.value="",E.value=""):(g.forEach((e=>{e.value&&(C=e.name,P=e.value)})),""!==P&&(function(e,t){const a=v.querySelectorAll(".card");S.forEach((n=>{n[`${e}`]!==t&&a.forEach((e=>{+e.dataset.id===n.id&&(e.style.display="none")}))}))}(C,P),L.classList.add("reset-button"),L.innerText="Скидання"))})),function(e){const t=new Image;t.onload=t.onerror=function(){1==(2==t.height)?document.querySelector("html").classList.add("webp"):document.querySelector("html").classList.add("no-webp")},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}(),$(window).on("load",(function(){$(".loader_inner").fadeOut(),$(".loader").delay(400).fadeOut("slow")}))})();